<!doctype html>
<html lang="en">
  <head>
    <link href='style/favicon.ico' rel='icon' type='image/x-icon'/>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>Blog</title>
    
    <link href="style/main.css" rel="stylesheet">

    <script>
      var inverted_index_json = null;
      
      fetch('cronjob/inverted_index.json')
              .then(response => response.json())
              .then(data => {
                  inverted_index_json = data;
              })
              .catch(error => console.error('Error loading JSON:', error));

      function searchKeyPress(event) {
          const element = document.getElementById("searchResults");
          element.style.display = 'none';
        
          if(inverted_index_json == null) {
            console.log("Json data with inverted index was not loaded yet");
            return;
          }

          if(event.code == "Enter"
             || event.keyCode == "13") //In mobile there is no Enter but Go
          {
            const searchTerm = document
                                .getElementById("search_term")
                                .value
                                toLowerCase();

            if(searchTerm in inverted_index_json)
              element.style.display = 'block';

              let htmlList = "";
              for (const document of inverted_index_json[searchTerm]) {
                htmlList += `<a href="${document}" target="_blank">${document}</a>` + "<br/>";
              }

              if(!htmlList)
                htmlList = "No results";
              
              element.innerHTML = htmlList;
          }
      };
      
    </script>
    
  </head>

  <body>
    
    <section class="main">
      <h1>Home</h1>
      
      <ul id="mainIndexList">
        <li><a href="quotes.html">Quotes</a></li>
        <li><a href="notesfromtheundergroundp1.html">Notes From The Underground - I</a></li>
        <li><a href="notesfromtheundergroundp2.html">Notes From The Underground - II</a></li>
        <li><a href="notesfromtheundergroundp3.html">Notes From The Underground - III</a></li>
        <li><a href="notesfromtheundergroundp4.html">Notes From The Underground - IV</a></li>
      </ul>

      <div id="search">
        <input id="search_term" type="text" placeholder="Search" onkeydown="searchKeyPress(event)" />
        <span class="refresh"><small><a href="cronjob/inverted_index_job.php" target="_blank">Refresh Cache</a></small></span>
        <div id="searchResults" style="display: none;"></div>
      </div>
      
      <div class="imageContext">
        <a href="imgs/105.jpg" target="_blank"><img src="imgs/105.jpg" /></a>
      </div>
      
    </section>
    
  </body>
</html>
